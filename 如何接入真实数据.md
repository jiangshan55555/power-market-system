# ğŸ”Œ å¦‚ä½•æ¥å…¥çœŸå®æ•°æ®å’Œæ¨¡å‹

## ğŸ“Š å½“å‰çŠ¶æ€

**âš ï¸ é¡¹ç›®ç›®å‰ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿæ•°æ®ï¼Œä¸æ˜¯çœŸå®æ•°æ®ï¼**

### æ¨¡æ‹Ÿæ•°æ®çš„ä½ç½®

1. **å†å²æ•°æ®**ï¼š`pages/api/historical-prices.js`ï¼ˆç¬¬36-53è¡Œï¼‰
   - ä½¿ç”¨ç®—æ³•ç”Ÿæˆéšæœºä»·æ ¼
   - æ ¹æ®æ—¶é—´æ®µï¼ˆæ—©é«˜å³°ã€æ™šé«˜å³°ï¼‰è°ƒæ•´ä»·æ ¼åŒºé—´

2. **é¢„æµ‹æ•°æ®**ï¼š`pages/api/predict.js`ï¼ˆç¬¬36-46è¡Œï¼‰
   - ç®€å•çš„è§„åˆ™é¢„æµ‹ï¼Œæ²¡æœ‰çœŸå®æ¨¡å‹
   - åœ¨å†å²ä»·æ ¼åŸºç¡€ä¸ŠåŠ éšæœºåç§»

3. **ä¼˜åŒ–ç­–ç•¥**ï¼š`pages/api/optimize.js`ï¼ˆç¬¬47-86è¡Œï¼‰
   - åŸºäºè§„åˆ™çš„ç®€å•ä¼˜åŒ–
   - æ²¡æœ‰çœŸå®çš„ç¥ç»åŠ¨åŠ›å­¦ç®—æ³•

4. **æ•°æ®åº“çŠ¶æ€**ï¼š`pages/api/database/status.js`ï¼ˆç¬¬18-46è¡Œï¼‰
   - ç¡¬ç¼–ç çš„å›ºå®šæ•°æ®

---

## ğŸ¯ æ¥å…¥çœŸå®æ•°æ®çš„ä¸‰ç§æ–¹æ¡ˆ

### **æ–¹æ¡ˆä¸€ï¼šè¿æ¥ MySQL/PostgreSQL æ•°æ®åº“** ğŸ—„ï¸

#### 1. å®‰è£…æ•°æ®åº“é©±åŠ¨

```bash
# MySQL
npm install mysql2

# æˆ– PostgreSQL
npm install pg
```

#### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```env
# æ•°æ®åº“é…ç½®
DB_HOST=your-database-host.com
DB_PORT=3306
DB_USER=your-username
DB_PASSWORD=your-password
DB_NAME=power_market_db

# æˆ–ä½¿ç”¨è¿æ¥å­—ç¬¦ä¸²
DATABASE_URL=mysql://user:password@host:3306/database
```

#### 3. åˆ›å»ºæ•°æ®åº“è¿æ¥

åˆ›å»º `lib/db.js`ï¼š

```javascript
import mysql from 'mysql2/promise';

const pool = mysql.createPool({
  host: process.env.DB_HOST,
  port: process.env.DB_PORT,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME,
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
});

export default pool;
```

#### 4. ä¿®æ”¹ API è·¯ç”±

ä¿®æ”¹ `pages/api/historical-prices.js`ï¼š

```javascript
import pool from '../../lib/db';

export default async function handler(req, res) {
  const { date } = req.query;

  try {
    // ä»çœŸå®æ•°æ®åº“æŸ¥è¯¢
    const [rows] = await pool.query(
      'SELECT timestamp, price, load FROM historical_prices WHERE DATE(timestamp) = ?',
      [date]
    );

    // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
    const prices = rows.map(r => r.price);
    const avgPrice = prices.reduce((a, b) => a + b, 0) / prices.length;

    res.status(200).json({
      success: true,
      date: date,
      data: rows,
      statistics: {
        count: rows.length,
        average_price: avgPrice,
        min_price: Math.min(...prices),
        max_price: Math.max(...prices)
      }
    });
  } catch (error) {
    res.status(500).json({ 
      success: false, 
      error: error.message 
    });
  }
}
```

#### 5. åœ¨ Vercel é…ç½®ç¯å¢ƒå˜é‡

éƒ¨ç½²åˆ° Vercel åï¼š
1. è¿›å…¥é¡¹ç›®è®¾ç½® â†’ Environment Variables
2. æ·»åŠ æ•°æ®åº“é…ç½®ï¼ˆDB_HOST, DB_USER, DB_PASSWORD ç­‰ï¼‰
3. é‡æ–°éƒ¨ç½²

---

### **æ–¹æ¡ˆäºŒï¼šè°ƒç”¨ Python æœºå™¨å­¦ä¹  API** ğŸ¤–

å¦‚æœæ‚¨æœ‰è®­ç»ƒå¥½çš„ Python æ¨¡å‹ï¼ˆSVMã€Random Forestã€XGBoostï¼‰ï¼Œå¯ä»¥ï¼š

#### 1. éƒ¨ç½² Python API

ä½¿ç”¨ Flask æˆ– FastAPI åˆ›å»º API æœåŠ¡ï¼š

```python
# app.py
from flask import Flask, request, jsonify
import joblib
import numpy as np

app = Flask(__name__)

# åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹
model = joblib.load('ensemble_model.pkl')

@app.route('/predict', methods=['POST'])
def predict():
    data = request.json
    features = np.array(data['features']).reshape(1, -1)
    
    # ä½¿ç”¨çœŸå®æ¨¡å‹é¢„æµ‹
    prediction = model.predict(features)
    
    return jsonify({
        'predicted_price': float(prediction[0]),
        'confidence': 0.92
    })

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
```

#### 2. éƒ¨ç½² Python API

é€‰é¡¹ï¼š
- **Railway**ï¼šhttps://railway.appï¼ˆæ¨èï¼Œå…è´¹é¢åº¦ï¼‰
- **Render**ï¼šhttps://render.com
- **Heroku**ï¼šhttps://heroku.com
- **è‡ªå·±çš„æœåŠ¡å™¨**

#### 3. ä¿®æ”¹ Next.js API è°ƒç”¨ Python æœåŠ¡

ä¿®æ”¹ `pages/api/predict.js`ï¼š

```javascript
export default async function handler(req, res) {
  const { date, features } = req.body;

  try {
    // è°ƒç”¨ Python API
    const response = await fetch('https://your-python-api.com/predict', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ features })
    });

    const result = await response.json();

    res.status(200).json({
      success: true,
      predictions: result,
      model_info: {
        name: 'ensemble',
        source: 'SVM + Random Forest + XGBoost',
        accuracy: 0.9234
      }
    });
  } catch (error) {
    res.status(500).json({ 
      success: false, 
      error: error.message 
    });
  }
}
```

---

### **æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ CSV/JSON é™æ€æ•°æ®æ–‡ä»¶** ğŸ“

å¦‚æœæ•°æ®é‡ä¸å¤§ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨é™æ€æ–‡ä»¶ï¼š

#### 1. å‡†å¤‡æ•°æ®æ–‡ä»¶

åˆ›å»º `public/data/historical_prices.json`ï¼š

```json
{
  "2025-05-01": [
    {"timestamp": "2025-05-01T00:00:00Z", "price": 250.5, "load": 850},
    {"timestamp": "2025-05-01T00:15:00Z", "price": 248.2, "load": 840},
    ...
  ],
  "2025-05-02": [...]
}
```

#### 2. ä¿®æ”¹ API è¯»å–æ–‡ä»¶

```javascript
import fs from 'fs';
import path from 'path';

export default function handler(req, res) {
  const { date } = req.query;

  // è¯»å– JSON æ–‡ä»¶
  const filePath = path.join(process.cwd(), 'public', 'data', 'historical_prices.json');
  const fileData = fs.readFileSync(filePath, 'utf8');
  const allData = JSON.parse(fileData);

  const data = allData[date] || [];

  res.status(200).json({
    success: true,
    date: date,
    data: data
  });
}
```

---

## ğŸ”§ æ¨èæ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **æ•°æ®åº“** | æ•°æ®é‡å¤§ã€æŸ¥è¯¢çµæ´»ã€å®æ—¶æ›´æ–° | éœ€è¦æ•°æ®åº“æœåŠ¡å™¨ã€é…ç½®å¤æ‚ | ç”Ÿäº§ç¯å¢ƒã€å¤§é‡æ•°æ® |
| **Python API** | ä½¿ç”¨çœŸå®æ¨¡å‹ã€åŠŸèƒ½å¼ºå¤§ | éœ€è¦é¢å¤–éƒ¨ç½²ã€ç»´æŠ¤æˆæœ¬é«˜ | éœ€è¦å¤æ‚é¢„æµ‹ç®—æ³• |
| **é™æ€æ–‡ä»¶** | ç®€å•ã€æ— éœ€é¢å¤–æœåŠ¡ã€å…è´¹ | æ•°æ®é‡æœ‰é™ã€ä¸èƒ½å®æ—¶æ›´æ–° | æ¼”ç¤ºã€å°æ•°æ®é›† |

---

## ğŸ“‹ æ‚¨éœ€è¦æä¾›çš„ä¿¡æ¯

å¦‚æœæ‚¨æƒ³æ¥å…¥çœŸå®æ•°æ®ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼š

### 1. æ•°æ®æ¥æº
- [ ] æœ‰ MySQL/PostgreSQL æ•°æ®åº“
- [ ] æœ‰ CSV/Excel æ–‡ä»¶
- [ ] æœ‰ Python è®­ç»ƒå¥½çš„æ¨¡å‹
- [ ] æœ‰å…¶ä»– API æ¥å£

### 2. æ•°æ®æ ¼å¼
- æ•°æ®åº“è¡¨ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ
- å­—æ®µåç§°æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆæ—¶é—´æˆ³ã€ä»·æ ¼ã€è´Ÿè·ç­‰ï¼‰
- æ•°æ®æ—¶é—´èŒƒå›´ï¼Ÿ

### 3. æ¨¡å‹ä¿¡æ¯
- ä½¿ç”¨ä»€ä¹ˆç®—æ³•ï¼Ÿï¼ˆSVMã€Random Forestã€XGBoostï¼‰
- æ¨¡å‹æ–‡ä»¶æ ¼å¼ï¼Ÿï¼ˆ.pklã€.h5ã€.ptï¼‰
- è¾“å…¥ç‰¹å¾æœ‰å“ªäº›ï¼Ÿ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆä»¥é™æ€æ–‡ä»¶ä¸ºä¾‹ï¼‰

å¦‚æœæ‚¨æœ‰ CSV æ•°æ®æ–‡ä»¶ï¼Œæˆ‘å¯ä»¥ç«‹å³å¸®æ‚¨ï¼š

1. **è½¬æ¢ CSV ä¸º JSON**
2. **ä¿®æ”¹ API è¯»å–çœŸå®æ•°æ®**
3. **ä¿æŒç•Œé¢ä¸å˜ï¼Œåªæ›¿æ¢æ•°æ®æº**

åªéœ€è¦æ‚¨æä¾›ï¼š
- CSV æ–‡ä»¶ï¼ˆæˆ–å‘Šè¯‰æˆ‘æ•°æ®æ ¼å¼ï¼‰
- å­—æ®µè¯´æ˜ï¼ˆå“ªä¸€åˆ—æ˜¯æ—¶é—´ã€ä»·æ ¼ã€è´Ÿè·ï¼‰

---

## ğŸ’¡ å»ºè®®

å¯¹äºæ‚¨çš„è®ºæ–‡é¡¹ç›®ï¼Œæˆ‘å»ºè®®ï¼š

1. **çŸ­æœŸï¼ˆæ¼”ç¤ºï¼‰**ï¼šä½¿ç”¨é™æ€ JSON æ–‡ä»¶
   - å¿«é€Ÿã€ç®€å•ã€å…è´¹
   - è¶³å¤Ÿå±•ç¤ºç³»ç»ŸåŠŸèƒ½

2. **é•¿æœŸï¼ˆç”Ÿäº§ï¼‰**ï¼šè¿æ¥æ•°æ®åº“ + Python API
   - çœŸå®çš„æ•°æ®æŸ¥è¯¢
   - çœŸå®çš„æ¨¡å‹é¢„æµ‹
   - å®Œæ•´çš„ç³»ç»Ÿæ¶æ„

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å‘Šè¯‰æˆ‘æ‚¨çš„æ•°æ®æƒ…å†µï¼Œæˆ‘å¯ä»¥ï¼š
- âœ… å¸®æ‚¨è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„
- âœ… ç¼–å†™æ•°æ®å¯¼å…¥è„šæœ¬
- âœ… ä¿®æ”¹ API æ¥å…¥çœŸå®æ•°æ®
- âœ… éƒ¨ç½² Python æ¨¡å‹æœåŠ¡
- âœ… é…ç½® Vercel ç¯å¢ƒå˜é‡

**ç°åœ¨å°±å‘Šè¯‰æˆ‘æ‚¨çš„æ•°æ®æ¥æºï¼Œæˆ‘ç«‹å³å¸®æ‚¨æ¥å…¥ï¼** ğŸš€

